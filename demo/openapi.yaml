openapi: 3.0.2
info:
  version: v1
  title: Te Rito APIs
  description: "<p>Derived from SIF Data Model (New Zealand) v3.2 (rc2)</p>
    <p><strong>Release Date: </strong>02-Oct-2020</p>"
  contact:
    name: Ministry of Education
    url: http://www.terito.govt.nz
    email: terito@education.govt.nz
servers:
  - url: https://{host}.edsby.co.nz/{basePath}
    description: The demonstration Te Rito server
    variables:
      host:
        default: southern
        description: southern.edsby.co.nz is the default demonstration platform
      basePath:
        default: sif
security:
  - sifDataObject:
      - sysadmin
      - TERITO_SMS
  - devt: []
paths:
  "/provider/{providerRefId}/StaffPersonal":
    post:
      summary: Default operation to create one or more StaffPersonal entries
      security:
        - sifDataObject:
            - sysadmin
      parameters:
        - $ref: "#/components/parameters/syncOverride"
      operationId: createStaffPersonals
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                StaffPersonals:
                  $ref: jsonSchema.NZ.create.yaml#/properties/StaffPersonals
            example:
              StaffPersonals:
                StaffPersonal:
                  - StaffPersonalRefId: d3e34f41-9d75-101a-8c3d-00aa001a1652
                    StaffPersonalLocalId: ST-001
                    PersonInfo:
                      Name:
                        FamilyName: Smith
                        GivenName: Fred
                        FullName: Fred Smith
                        IsVerified: N
                      Demographics:
                        BirthDate: 1966-05-01
                      EmailList:
                        Email:
                          - Type: PRIM
                            Address: freddy@mailinator.com
          application/xml:
            schema:
              type: object
              properties:
                StaffPersonals:
                  $ref: jsonSchema.NZ.create.yaml#/properties/StaffPersonals
            example: >-
              <StaffPersonals>
                <StaffPersonal>
                  <StaffPersonalRefId>d3e34f41-9d75-101a-8c3d-00aa001a1652</StaffPersonalRefId>
                  <StaffPersonalLocalId>ST-001</StaffPersonalLocalId>
                  <PersonInfo>
                    <Name>
                      <FamilyName>Smith</FamilyName>
                      <GivenName>Fred</GivenName>
                      <FullName>Fred Smith</FullName>
                      <IsVerified>N</IsVerified>
                    </Name>
                    <Demographics>
                      <BirthDate>1966-05-01</BirthDate>
                    </Demographics>          
                    <EmailList>
                      <Email>
                        <Type>PRIM</Type>
                        <Address>freddy@gmail.com</Address>
                      </Email>
                    </EmailList>
                  </PersonInfo>
                </StaffPersonal>
                <StaffPersonal>
                  <StaffPersonalRefId>d3e34f41-9d75-101a-8c3d-00aa001b3652</StaffPersonalRefId>
                  <StaffPersonalLocalId>ST-002</StaffPersonalLocalId>
                  <PersonInfo>
                    <Name>
                      <FullName>Fred Jones</FullName>
                      <IsVerified>N</IsVerified>
                    </Name>
                    <Demographics>
                      <BirthDate>1966-05-01</BirthDate>
                    </Demographics>          
                    <EmailList>
                      <Email>
                        <Type>PRIM</Type>
                        <Address>fredJ@gmail.com</Address>
                      </Email>
                    </EmailList>
                  </PersonInfo>
                </StaffPersonal>      
              </StaffPersonals>
      responses:
        "201":
          description: All objects created
          content:
            application/json:
              schema:
                type: object
                properties:
                  StaffPersonals:
                    $ref: jsonSchema.NZ.create.yaml#/properties/StaffPersonals
              example:
                $ref: "#/paths/~1provider~1%7BproviderRefId%7D~1StaffPersonal/post/\
                  requestBody/content/application~1json/example"
            application/xml:
              schema:
                type: object
                properties:
                  StaffPersonals:
                    $ref: jsonSchema.NZ.create.yaml#/properties/StaffPersonals
              example:
                $ref: "#/paths/~1provider~1%7BproviderRefId%7D~1StaffPersonal/post/\
                  requestBody/content/application~1xml/example"
        default:
          description: Some objects created, some objects failed
          content:
            application/json:
              schema:
                type: array
                items:
                  anyOf:
                    - type: object
                      title: Error
                      properties:
                        Error:
                          $ref: "#/components/error"
                    - type: object
                      title: StaffPersonal
                      properties:
                        StaffPersonal:
                          $ref: jsonSchema.NZ.create.yaml#/properties/StaffPersonal
  "/Organisation/{OrganisationsRefId}":
    get:
      summary: Default operation to get a single Organisation
      operationId: getOrganisation
      parameters:
        - name: fields
          in: query
          description: Return only specified fields	`fields=name,nid`
          schema:
            type: string
        - name: page
          in: query
          description: Return nth page of results; default 0	`page=2`; applies to any call
            with repeated data
          schema:
            type: integer
            minimum: 0
        - name: max
          in: query
          description: Maximum items per page, default 10,000; `max=100`; applies to any
            call with repeated data
          schema:
            type: integer
            minimum: 1
        - name: unwrap
          in: query
          description: Remove top level wrapper from json results in single result
            reponses;	`unwrap=1`
          schema:
            enum:
              - 0
              - 1
              - 2
        - name: human
          in: query
          description: For code set fields, translate code to human readable form;	`human=1`
          schema:
            enum:
              - 0
              - 1
        - name: start
          in: query
          description: Include only items from start date;	`start=2017-01-01`
          schema:
            type: string
            format: date
        - name: end
          in: query
          description: Include only items before end date;	`end=2017-08-31`
          schema:
            type: string
            format: date
        - name: sort
          in: query
          description: Sort results by specified field;	`sort=FamilyName`
          schema:
            type: string
        - name: field
          in: query
          description: Field to filter on when used with **pattern**;	`field=FamilyName`
          schema:
            type: string
        - name: pattern
          in: query
          description: Filter results using pattern on **field**; `pattern=Sco*`
          schema:
            type: string
        - name: X-Edsby-OrganisationRefId
          in: header
          required: true
          description: <p>The Ministry of Education Organisation Id of the Provider(or
            other Organisation); used to limit the scope of the API endpoint to
            a particular MoE Organisation.</p>
          schema:
            type: string
            pattern: ^[1-9][0-9]{0,4}$
        - name: OrganisationRefId
          in: path
          description: <p>The SIF GUID used by systems to identify the organisation.</p>
          required: true
          schema:
            type: string
      responses:
        "200":
          description: successful operation
          content:
            application/json:
              schema:
                type: object
                properties:
                  Organisation:
                    $ref: jsonSchema.NZ.create.yaml#/properties/Organisation
              example:
                Organisation:
                  OrganisationRefId: "922"
                  OrganisationLocalId: "42342"
                  Name: Hogwart's Area School
                  Authority: STATE
                  SectorRole: "35003"
                  Type: "10030"
                  OperationalStatus: O
                  EntityOpen: 1652-04-01
                  EducationRegion: "12013"
                  SpecialEducationDistrict: "182011"
                  AddressList:
                    Address:
                      - Type: RU
                        Role: PHY
                        Line1: 1175 Lake Ferry Rd
                        Suburb: RD 1
                        City: Martinborough
                  CommunicationChannelList:
                    Channel:
                      - Notes: Attendance System (Self Service)
                        Type: WEB
                        Value: http://att.hogwarts.school.nz
                      - Notes: School Website
                        Type: WEB
                        Value: http://www.hogwarts.school.nz
                  ContactList:
                    Contact:
                      - Name:
                          FamilyName: Dumbledore
                          GivenName: Albus
                          FullName: Albus Dumbledore
                        PositionTitle: Headmaster
                        Role: PRI
                        AddressList:
                          Address:
                            - Type: TH
                              Role: PHY
                              Line1: 533 Hogwart's Way
                              City: Hogsmead
                              PostalCode: "7733"
                        EmailList:
                          Email: []
                        PhoneNumberList:
                          PhoneNumber: []
                      - Name:
                          FamilyName: Hagrid
                          GivenName: Rubeus
                          FullName: Rubeus Hagrid
                        PositionTitle: Gamekeeper
                        Role: DIR
                        AddressList:
                          Address:
                            - Type: TH
                              Role: PHY
                              Line1: The Enchanted Wood
                              Line2: 533 Hogwart's Way
                              City: Hogsmead
                              PostalCode: "7733"
                        EmailList:
                          Email: []
                        PhoneNumberList:
                          PhoneNumber: []
                  EmailList:
                    Email:
                      - Type: PRIM
                        Address: stuart@gmail.com
                  LocationList:
                    Location:
                      - Description: Only Campus
                        Address:
                          Type: RU
                          Role: PHY
                          Line1: 1175 Lake Ferry Rd
                          Suburb: RD 1
                          City: Martinborough
                          PostalCode: "5781"
                        GridLocation:
                          Latitude: -41.2814719
                          Longitude: 175.3458472
                        StatisticalAreaList:
                          StatisticalArea:
                            - SpatialUnitType: GE
                              Code: "058"
                            - SpatialUnitType: TA
                              Code: "050"
                            - SpatialUnitType: WA
                              Code: "05003"
                  PhoneNumberList:
                    PhoneNumber:
                      - Notes: Attendance Office (Automated)
                        Usage: SMS
                        Type: WTE
                        Number: (0274) 300 9991
                      - Notes: Attendance Office
                        Usage: INT
                        Type: WTE
                        Number: (04) 300 9992
                      - Notes: School Secretary DDI
                        Type: WTE
                        Number: (04) 300 9993
                  SchoolService:
                    CoEdStatus: COED
                    Decile: 5
                    NewEntrantPolicyList:
                      EnactedPolicy:
                        - EffectiveTo: 2018-12-31
                          Policy: AE
                        - EffectiveFrom: 2019-01-01
                          Policy: CE
                    SchoolYearList:
                      SchoolYear:
                        - YearLevel: 1
                          FIRSTSchoolYearGenderId: 1001
                          Gender: C
                        - YearLevel: 2
                          FIRSTSchoolYearGenderId: 1002
                          Gender: C
                        - YearLevel: 3
                          FIRSTSchoolYearGenderId: 1003
                          Gender: C
                        - YearLevel: 4
                          FIRSTSchoolYearGenderId: 1004
                          Gender: C
                        - YearLevel: 5
                          FIRSTSchoolYearGenderId: 1005
                          Gender: C
                        - YearLevel: 6
                          FIRSTSchoolYearGenderId: 1006
                          Gender: C
                        - YearLevel: 7
                          FIRSTSchoolYearGenderId: 1007
                          Gender: C
                        - YearLevel: 8
                          FIRSTSchoolYearGenderId: 1008
                          Gender: C
                        - YearLevel: 9
                          FIRSTSchoolYearGenderId: 1009
                          Gender: F
                        - YearLevel: 10
                          FIRSTSchoolYearGenderId: 1010
                          Gender: F
                        - YearLevel: 11
                          FIRSTSchoolYearGenderId: 1011
                          Gender: F
                        - YearLevel: 12
                          FIRSTSchoolYearGenderId: 1012
                          Gender: F
                        - YearLevel: 13
                          FIRSTSchoolYearGenderId: 1013
                          Gender: F
        default:
          description: Failed to retrieve object(s).
          content:
            application/json:
              schema:
                type: object
                title: error
                required:
                  - error
                  - when
                  - errorstr
                additionalProperties: false
                properties:
                  error:
                    type: integer
                    description: Edsby defined error code
                  when:
                    type: string
                    format: date-time
                    description: Date and Time of when the HTTP request was processed.
                  errorstr:
                    type: string
                    description: Narrative text describing the error
                  refId:
                    type: string
                    description: Data object refId of the object being created/updated
                  localId:
                    type: string
                    description: Data object localId of the object being created/updated
              example:
                error: 1009
                when: 2020-07-16T20:00:46.000Z
                errorstr: "Bad field: PersonInfo-Name-FamilyName: missing required field
                  PersonInfo-Name-FamilyName (LastName) 'None'"
                localId: ST-002
            application/xml:
              schema:
                type: object
                title: error
                required:
                  - error
                  - when
                  - errorstr
                additionalProperties: false
                properties:
                  error:
                    type: integer
                    description: Edsby defined error code
                  when:
                    type: string
                    format: date-time
                    description: Date and Time of when the HTTP request was processed.
                  errorstr:
                    type: string
                    description: Narrative text describing the error
                  refId:
                    type: string
                    description: Data object refId of the object being created/updated
                  localId:
                    type: string
                    description: Data object localId of the object being created/updated
              example: >-
                <Error>
                  <error>1009</error>
                  <when>2020-07-16T20:00:46.000Z</when>
                  <errorstr>Bad field: PersonInfo-Name-FamilyName: missing required field PersonInfo-Name-FamilyName (LastName) 'None'</errorstr>
                  <localId>ST-002</localId>
                </Error>
  "/Enrolment/{EnrolmentRefId}":
    get:
      summary: Default operation to get a OrganisationStudentEnrolment
      operationId: getEnrolment
      parameters:
        - name: EnrolmentRefId
          in: path
          description: <p>The SIF GUID used by systems to identify the enrolment.</p>
          required: true
          schema:
            type: string
      responses:
        "200":
          description: successful operation
          content:
            application/json:
              schema:
                type: object
                properties:
                  Enrolment:
                    $ref: jsonSchema.NZ.create.yaml#/properties/StudentProviderEnrolment
              example:
                StudentProviderEnrolment:
                  StudentProviderEnrolmentLocalId: 2020_8001_ST1000001
                  Student:
                    LocalId: ST1000001
                    NationalStudentNumber: 9001000001
                  Provider:
                    RefId: "8001"
                  StudentId: ST1000001
                  EntryDate: 2015-03-07
                  Status: ACT
                  ECEEducationHistoryList:
                    ECEType:
                      - Type: EPG
                  SchoolEnrolmentList:
                    SchoolEnrolment:
                      - SchoolCalendarYear: 2020
                        StartDate: 2020-01-27
                        MembershipType: BASE
                        YearLevel: 6
                        FTE: 1
                        FundingType: SF
                        FundingYearLevel: 6
                        Curriculum: NZC
        default:
          $ref: "#/paths/~1Organisation~1%7BOrganisationsRefId%7D/get/responses/def\
            ault"
  "/OrganisationRelationship/{OrganisationRelationshipRefId}":
    get:
      summary: Default operation to get a single OrganisationRelationship
      operationId: getOrganisationReln
      parameters:
        - name: OrganisationRelationshipRefId
          in: path
          description: <p>The SIF GUID used by systems to identify the organisation.</p>
          required: true
          schema:
            type: string
      responses:
        "200":
          description: successful operation
          content:
            application/json:
              schema:
                type: object
                properties:
                  Organisation:
                    $ref: jsonSchema.NZ.create.yaml#/properties/OrganisationRelationship
              example:
                OrganisationRelationship:
                  OrganisationRelationshipLocalId: 90100_8001
                  Status: A
                  RelationshipType: "34037"
                  SourceOrganisation:
                    RefId: "90100"
                  SourceOrganisationRole: LSC
                  SourceOrganisationAgreementDate: 2020-01-15
                  RelatedOrganisation:
                    RefId: "8001"
                  RelatedOrganisationRole: "184000"
                  RelatedOrganisationAgreementDate: 2020-01-15
                  EffectiveDate: 2020-01-15
        default:
          $ref: "#/paths/~1Organisation~1%7BOrganisationsRefId%7D/get/responses/def\
            ault"
  /Search:
    get:
      tags:
        - Search
      summary: Search for Staff and Students
      description: >-
        Search operation returning partial <a
        href="#tag/StaffPersonal">StaffPersonal</a>

        and <a href="#tag/StudentPersonal">StudentPersonal</a> objects.
      operationId: search
      security:
        - sifDataObject:
            - FIRST
            - SUPS
            - SMS
      parameters:
        - name: objects
          in: query
          description: "CSV delimited list of data object names; limits the search to only
            some data objects: staffpersonal, studentpersonal"
          schema:
            type: string
        - name: pattern
          in: query
          description: Select objects where search index includes the given pattern
            pattern; `pattern=Sco*`
          schema:
            type: string
        - name: query
          in: query
          description: Use lucene query language to select objects;
          schema:
            type: string
        - name: max
          in: query
          description: Maximum items per page, default 10,000; `max=100`; applies to any
            call with repeated data
          schema:
            type: integer
            minimum: 1
        - name: page
          in: query
          description: Return nth page of results; default 0	`page=2`; applies to any call
            with repeated data
          schema:
            type: integer
            minimum: 0
        - name: human
          in: query
          description: For code set fields, translate code to human readable form;	`human=1`
          schema:
            enum:
              - 0
              - 1
        - name: Accept
          in: header
          description: Standard HTTP accept header, choose between JSON and XML for
            response. Defaults to XML if this header is missing.
          schema:
            type: string
            enum:
              - application/json
              - application/xml
      responses:
        "200":
          description: successful operation
          content:
            application/json:
              schema:
                type: object
                properties:
                  Search:
                    type: object
                    properties:
                      Summary:
                        type: object
                        description: Statistical summary of the search results returned.
                        properties:
                          Shown:
                            type: integer
                            description: Count of objects returned in this response
                          More:
                            type: integer
                            description: Count of objects yet to be returned, because of
                              `max` page size limit
                      SearchResults:
                        type: object
                        description: The data objects found
                        properties:
                          Personals:
                            type: object
                            description: Staff &amp; Student Personal objects found
                            properties:
                              StaffPersonals:
                                type: object
                                description: StaffPersonal objects found
                                properties:
                                  StaffPersonal:
                                    type: array
                                    items:
                                      type: object
                                      properties:
                                        Name:
                                          type: string
                                          description: Full name from the search index
                                        Rank:
                                          type: number
                                          description: Degree of match to search criteria
                                        Type:
                                          type: string
                                          description: Internal data type of object returned
                                        ProviderName:
                                          type: array
                                          description: Array of strings, being the names of
                                            the Providers associated with the
                                            person
                                          items:
                                            type: string
                                        ProviderRefId:
                                          type: array
                                          description: Array of strings, being the
                                            ProviderRefIds of the Providers
                                            associated with the person
                                          items:
                                            type: string
                                        LocalId:
                                          type: string
                                          description: The StaffPersonalLocalId of the
                                            staff member located
                                        RefId:
                                          type: string
                                          description: The StaffPersonalRefId of the staff
                                            member located
                                        ESLPairwiseId:
                                          type: string
                                          description: Internal user provisioning
                                            identifier for the staff member
                                            located
                                        PersonInfo:
                                          type: object
                                          description: Partial PersonInfo object
                                          properties:
                                            Name:
                                              type: object
                                              description: Person name, in pieces and
                                                complete
                                              properties:
                                                Title:
                                                  type: string
                                                FamilyName:
                                                  type: string
                                                GivenName:
                                                  type: string
                                                MiddleName:
                                                  type: string
                                                PreferredGivenName:
                                                  type: string
                                                Suffix:
                                                  type: string
                                                FullName:
                                                  type: string
                                            Demographics:
                                              type: object
                                              properties:
                                                BirthDate:
                                                  type: string
                                                  format: date
                                            EmailList:
                                              type: object
                                              properties:
                                                Email:
                                                  type: object
                                                  properties:
                                                    Address:
                                                      type: string
                              StudentPersonals:
                                type: object
                                properties:
                                  StudentPersonal:
                                    type: array
                                    items:
                                      type: object
                                      properties:
                                        Name:
                                          type: string
                                          description: Full name from the search index
                                        Rank:
                                          type: number
                                          description: Degree of match to search criteria
                                        Type:
                                          type: string
                                          description: Internal data type of object returned
                                        ProviderName:
                                          type: array
                                          description: Array of strings, being the names of
                                            the Providers associated with the
                                            person
                                          items:
                                            type: string
                                        ProviderRefId:
                                          type: array
                                          description: Array of strings, being the
                                            ProviderRefIds of the Providers
                                            associated with the person
                                          items:
                                            type: string
                                        LocalId:
                                          type: string
                                          description: The StudentPersonalLocalId of the
                                            student located
                                        RefId:
                                          type: string
                                          description: The StudentPersonalRefId of the
                                            student located
                                        NationalStudentNumber:
                                          type: string
                                          description: The National Student Number of the
                                            student located
                                        PersonInfo:
                                          type: object
                                          description: Partial PersonInfo object
                                          properties:
                                            Name:
                                              type: object
                                              description: Person name, in pieces and
                                                complete
                                              properties:
                                                Title:
                                                  type: string
                                                FamilyName:
                                                  type: string
                                                GivenName:
                                                  type: string
                                                MiddleName:
                                                  type: string
                                                PreferredGivenName:
                                                  type: string
                                                Suffix:
                                                  type: string
                                                FullName:
                                                  type: string
                                            Demographics:
                                              type: object
                                              properties:
                                                BirthDate:
                                                  type: string
                                                  format: date
                                                Gender:
                                                  $ref: jsonSchema.NZ.create.yaml#/definitions/NZCodeSetsGender
                                            EmailList:
                                              type: object
                                              properties:
                                                Email:
                                                  type: object
                                                  properties:
                                                    Address:
                                                      type: string
        "401":
          description: Request didn't have Bearer token
          content:
            application/json:
              schema:
                type: object
                title: error
                required:
                  - error
                  - when
                  - errorstr
                additionalProperties: false
                properties:
                  error:
                    type: integer
                    description: Edsby defined error code
                  when:
                    type: string
                    format: date-time
                    description: Date and Time of when the HTTP request was processed.
                  errorstr:
                    type: string
                    description: Narrative text describing the error
                  refId:
                    type: string
                    description: Data object refId of the object being created/updated
                  localId:
                    type: string
                    description: Data object localId of the object being created/updated
              example:
                error: 401
                when: 2020-07-16T20:00:46.000Z
                errorstr: "Unauthorised request: Bearer token missing??"
        "422":
          description: Request didn't have Accept header
          content:
            application/json:
              schema:
                type: object
                title: error
                required:
                  - error
                  - when
                  - errorstr
                additionalProperties: false
                properties:
                  error:
                    type: integer
                    description: Edsby defined error code
                  when:
                    type: string
                    format: date-time
                    description: Date and Time of when the HTTP request was processed.
                  errorstr:
                    type: string
                    description: Narrative text describing the error
                  refId:
                    type: string
                    description: Data object refId of the object being created/updated
                  localId:
                    type: string
                    description: Data object localId of the object being created/updated
              example:
                error: 422
                when: 2020-07-16T20:00:46.000Z
                errorstr: "Unprocessable request: Accept or X-Edsby-OrganisationRefId
                  header missing?? Request body invalid??  Check sl-violations
                  header in response"
components:
  securitySchemes:
    devt:
      type: http
      scheme: basic
      description: >-
        HTTP Basic authentication is only available on 'sandbox' edsby
        environments

        to facilitate development testing
    sifDataObject:
      type: http
      scheme: bearer
      bearerFormat: SIF Session Token
      description: >-
        HTTP Bearer authentication is applied to all SIF data objects; with the
        bearer token being the SIF Session Token

        that was returned by a call to the [SIF environment](#operation/createEnvironment) service.
  error:
    type: object
    title: error
    required:
      - error
      - when
      - errorstr
    additionalProperties: false
    properties:
      error:
        type: integer
        description: Edsby defined error code
      when:
        type: string
        format: date-time
        description: Date and Time of when the HTTP request was processed.
      errorstr:
        type: string
        description: Narrative text describing the error
      refId:
        type: string
        description: Data object refId of the object being created/updated
      localId:
        type: string
        description: Data object localId of the object being created/updated
  parameters:
    syncOverride:
      name: x-http-method-override
      in: header
      description: Rather than CREATE records, treat this request as a SYNC request.
      schema:
        type: string
        oneOf:
          - enum:
              - IncrSYNC
            title: Incremental Synchronise Request
            description: Add and Update records from the POST to ensure all records are
              present in the repository
          - enum:
              - FullSYNC
            title: Full Synchronise Request
            description: Add, Update and **Delete** records to ensure that ONLY those
              records are present in the repository
